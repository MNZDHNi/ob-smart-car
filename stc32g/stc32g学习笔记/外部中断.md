# 一、概述

| 中断源      | 引脚   | 触发方式            | 优先级配置 | 标志位            | 特点             |
| -------- | ---- | --------------- | ----- | -------------- | -------------- |
| **INT0** | P3.2 | **上升沿**或**下降沿** | 可配置   | IE0 (需软件清零)    | 功能最全面，支持两种边沿触发 |
| **INT1** | P3.3 | **上升沿**或**下降沿** | 可配置   | IE1 (需软件清零)    | 功能最全面，支持两种边沿触发 |
| **INT2** | P3.6 | **下降沿**         | 可配置   | INT2IF (需软件清零) | 仅支持下降沿触发       |
| **INT3** | P3.7 | **下降沿**         | 可配置   | INT3IF (需软件清零) | 仅支持下降沿触发       |
| **INT4** | P3.0 | **下降沿**         | 可配置   | INT4IF (需软件清零) | 仅支持下降沿触发       |

# 二、中断初始化

1. **引脚配置** - 设置GPIO工作模式
2. **中断参数配置** - 设置触发方式、优先级等
3. **中断使能** - 开启中断功能

## 1.INT1/INT2  

```c
/**
 * @brief  INT0 外部中断初始化
 * @param  trigger_mode: 触发方式
 *         0 - 上升沿/下降沿均可触发
 *         1 - 仅下降沿触发
 */
void INT0_Init(uint8_t trigger_mode)
{
    // 1. 配置P3.2引脚为高阻输入或准双向口
    P3M1 |= 0x04;   // P3.2 设置为高阻输入
    P3M0 &= ~0x04;
    // 或者使用准双向口: P3M1 = 0x00; P3M0 = 0x00;
    
    // 2. 设置触发方式
    IT0 = trigger_mode;     // IT0=1:仅下降沿; IT0=0:双沿触发
    
    // 3. 清除中断标志位
    IE0 = 0;
    
    // 4. 使能INT0中断
    EX0 = 1;
    
    // 5. 设置中断优先级（可选）
    PX0 = 1;        // 高优先级
    // PX0 = 0;    // 低优先级
    
    // 6. 开启总中断
    EA = 1;
}

/**
 * @brief  INT1 外部中断初始化
 */
void INT1_Init(uint8_t trigger_mode)
{
    // 1. 配置P3.3引脚
    P3M1 |= 0x08;   // P3.3 高阻输入
    P3M0 &= ~0x08;
    
    // 2. 设置触发方式
    IT1 = trigger_mode;
    
    // 3. 清除中断标志位
    IE1 = 0;
    
    // 4. 使能INT1中断
    EX1 = 1;
    
    // 5. 设置优先级
    PX1 = 1;        // 高优先级
    
    // 6. 开启总中断
    EA = 1;
}
```

## 2.INT3···

```c
/**
 * @brief  INT2 外部中断初始化（仅下降沿触发）
 * @note   INT2固定为下降沿触发，不可配置其他方式
 */
void INT2_Init(void)
{
    // 1. 配置P3.6引脚
    P3M1 |= 0x40;   // P3.6 高阻输入
    P3M0 &= ~0x40;
    
    // 2. 使能INT2中断
    INT2 = 1;       // 使能INT2中断
    
    // 3. 清除中断标志位
    INT2IF = 0;
    
    // 4. 设置优先级（通过PX2H和PX2L）
    PX2H = 1;       // 高优先级高位
    PX2L = 1;       // 高优先级低位
    // 优先级设置: 
    // PX2H=0,PX2L=0 -> 优先级0(最低)
    // PX2H=0,PX2L=1 -> 优先级1
    // PX2H=1,PX2L=0 -> 优先级2  
    // PX2H=1,PX2L=1 -> 优先级3(最高)
    
    // 5. 开启总中断
    EA = 1;
}

/**
 * @brief  INT3 外部中断初始化
 */
void INT3_Init(void)
{
    // 配置P3.7引脚
    P3M1 |= 0x80;
    P3M0 &= ~0x80;
    
    INT3 = 1;       // 使能INT3
    INT3IF = 0;     // 清除标志位
    
    // 设置优先级
    PX3H = 1;
    PX3L = 0;
    
    EA = 1;
}

/**
 * @brief  INT4 外部中断初始化
 */
void INT4_Init(void)
{
    // 配置P3.0引脚
    P3M1 |= 0x01;
    P3M0 &= ~0x01;
    
    INT4 = 1;       // 使能INT4
    INT4IF = 0;     // 清除标志位
    
    // 设置优先级
    PX4H = 0;
    PX4L = 1;
    
    EA = 1;
}
```