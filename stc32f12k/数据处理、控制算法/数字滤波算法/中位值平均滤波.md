```c
#define MID_FILTER_SIZE 5

uint16_t MedianAverage_Filter(uint16_t new_val)
{
    static uint16_t buffer[MID_FILTER_SIZE];
    static uint8_t index = 0;
    uint16_t temp[MID_FILTER_SIZE];
    
    // 更新缓冲区
    buffer[index] = new_val;
    index = (index + 1) % MID_FILTER_SIZE;
    
    // 复制到临时数组排序
    memcpy(temp, buffer, sizeof(buffer));
    
    // 冒泡排序
    for(int i=0; i<MID_FILTER_SIZE-1; i++) {
        for(int j=0; j<MID_FILTER_SIZE-1-i; j++) {
            if(temp[j] > temp[j+1]) {
                uint16_t tmp = temp[j];
                temp[j] = temp[j+1];
                temp[j+1] = tmp;
            }
        }
    }
    
    // 取中位值平均（去掉最大最小值）
    uint32_t sum = 0;
    for(int i=1; i<MID_FILTER_SIZE-1; i++) {
        sum += temp[i];
    }
    
    return sum / (MID_FILTER_SIZE-2);
}
```