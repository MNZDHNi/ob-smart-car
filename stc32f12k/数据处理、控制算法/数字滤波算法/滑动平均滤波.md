```c
#define FILTER_SIZE 8

typedef struct {
    uint16_t buffer[FILTER_SIZE];
    uint8_t index;
    uint32_t sum;
} MovingAverage_Filter;

uint16_t MovingAverage_Update(MovingAverage_Filter *filter, uint16_t new_val)
{
    // 减去最旧的值，加上最新的值
    filter->sum = filter->sum - filter->buffer[filter->index] + new_val;
    filter->buffer[filter->index] = new_val;
    filter->index = (filter->index + 1) % FILTER_SIZE;
    
    return (uint16_t)(filter->sum / FILTER_SIZE);
}
```
